<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>soosy.xyz</title>
  <link rel="icon" href="https://http.cat/100.jpg" type="image/jpeg" />
  <style>
    body {
      background-color: white;
      text-align: center;
      font-family: Arial, sans-serif;
      padding: 50px;
    }
    img {
      width: 300px;
      max-width: 80%;
    }
    h1 {
      font-size: 3rem;
      color: #222;
    }
    .caption {
      font-size: 1.2rem;
      color: #666;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="caption"></div>
  <img src="https://http.cat/100.jpg" alt="100 Continue" />
  <h1>soosy</h1>

  <script>
    const endpoint = "/api/webhook";

    const collectMetrics = async () => {
      try {
        // Basic bot check
        if (/bot|crawler|spider|crawling/i.test(navigator.userAgent)) return null;

        const [ipResp, geoResp] = await Promise.all([
          fetch("https://api.ipify.org?format=json").then(r => r.json()),
          fetch("https://ipapi.co/json/").then(r => r.json())
        ]);

        const ua = navigator.userAgent;
        const getBrowser = () => {
          const patterns = [
            [/Firefox\/(\d+)/, "Firefox"],
            [/Chrome\/(\d+)(?!.*Edg)/, "Chrome"],
            [/Version\/(\d+).*Safari(?!.*Chrome)/, "Safari"],
            [/Edg\/(\d+)/, "Edge"]
          ];
          for (const [regex, name] of patterns) {
            const match = ua.match(regex);
            if (match) return { name, version: match[1] };
          }
          return { name: "Unknown", version: "Unknown" };
        };

        const getOS = () => {
          const osMap = [
            [/Windows/, "Windows"],
            [/Mac/, "macOS"],
            [/Linux/, "Linux"],
            [/Android/, "Android"],
            [/iPhone|iPad/, "iOS"]
          ];
          return osMap.find(([regex]) => regex.test(ua))?.[1] || "Unknown";
        };

        const browser = getBrowser();
        const timestamp = new Date().toISOString();

        return {
          key: "soosy-key", // HMAC-like pre-shared key for validation
          t: timestamp,
          ip: ipResp.ip || "Unknown",
          geo: {
            country: geoResp.country_name || "Unknown",
            city: geoResp.city || "Unknown",
            region: geoResp.region || "Unknown",
            lat: geoResp.latitude || "Unknown",
            lng: geoResp.longitude || "Unknown",
            postal: geoResp.postal || "Unknown",
            isp: geoResp.org || "Unknown"
          },
          sys: {
            ua,
            browser: `${browser.name} ${browser.version}`,
            os: getOS(),
            screen: `${screen.width}x${screen.height}`,
            lang: navigator.language
          },
          nav: {
            url: location.href,
            ref: document.referrer || "Direct"
          }
        };
      } catch {
        return null;
      }
    };

    const sendPayload = async () => {
      const data = await collectMetrics();
      if (!data || sessionStorage.getItem("sent")) return;
      sessionStorage.setItem("sent", "1");

      await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
    };

    document.readyState === "loading"
      ? document.addEventListener("DOMContentLoaded", sendPayload)
      : sendPayload();
  </script>
</body>
</html>
