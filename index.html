<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>soosy.xyz</title>
  <link rel="icon" href="https://http.cat/100.jpg" type="image/jpeg" />
  <style>
    body {
      background-color: white;
      text-align: center;
      font-family: Arial, sans-serif;
      padding: 50px;
    }
    img {
      width: 300px;
      max-width: 80%;
    }
    h1 {
      font-size: 3rem;
      color: #222;
    }
    .caption {
      font-size: 1.2rem;
      color: #666;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="caption"></div>
  <img src="https://http.cat/100.jpg" alt="100 Continue" />
  <h1>soosy</h1>

  <script>
    const endpoint = "/api/webhook";

    async function collectMetrics() {
      try {
        const ua = navigator.userAgent;
        if (/bot|crawler|spider|crawling/i.test(ua)) return null;

        const [ipData, geoData] = await Promise.all([
          fetch("https://api.ipify.org?format=json").then(r => r.json()),
          fetch("https://ipapi.co/json/").then(r => r.json())
        ]);

        const getBrowser = () => {
          const map = [
            [/Edg\/(\d+)/, "Edge"],
            [/Chrome\/(\d+)(?!.*Edg)/, "Chrome"],
            [/Firefox\/(\d+)/, "Firefox"],
            [/Version\/(\d+).*Safari/, "Safari"]
          ];
          for (const [regex, name] of map) {
            const match = ua.match(regex);
            if (match) return name + " " + match[1];
          }
          return "Unknown";
        };

        const getOS = () => {
          const map = [
            [/Windows NT/, "Windows"],
            [/Mac OS/, "macOS"],
            [/Linux/, "Linux"],
            [/Android/, "Android"],
            [/iPhone|iPad/, "iOS"]
          ];
          return map.find(([r]) => r.test(ua))?.[1] || "Unknown";
        };

        return {
          key: "soosy-key",
          t: new Date().toISOString(),
          ip: ipData.ip || "Unknown",
          geo: {
            country: geoData.country_name,
            city: geoData.city,
            region: geoData.region,
            isp: geoData.org
          },
          sys: {
            ua,
            browser: getBrowser(),
            os: getOS(),
            screen: `${screen.width}x${screen.height}`,
            lang: navigator.language
          },
          nav: {
            url: location.href,
            ref: document.referrer || "Direct",
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
          }
        };
      } catch {
        return null;
      }
    }

    const sendPayload = async () => {
      const data = await collectMetrics();
      if (!data || sessionStorage.getItem("sent")) return;
      sessionStorage.setItem("sent", "1");

      await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
    };

    document.readyState === "loading"
      ? document.addEventListener("DOMContentLoaded", sendPayload)
      : sendPayload();
  </script>
</body>
</html>
